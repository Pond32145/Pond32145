name: DevOps Terminal

# üîê ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô push ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (403)
permissions:
  contents: write

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */12 * * *" # ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å 12 ‡∏ä‡∏°.

jobs:
  generate-terminal:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ checkout repo
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ install termtosvg
      - name: Install termtosvg
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip
          pip3 install termtosvg

      # 3Ô∏è‚É£ ‡∏™‡∏£‡πâ‡∏≤‡∏á static terminal (‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö)
      - name: Generate static DevOps terminal SVG
        run: |
          mkdir -p assets
          termtosvg --still -c "
          echo 'pond@prod:~$ whoami'
          echo 'pond_np31 (DevOps Engineer)'
          echo ''
          echo 'pond@prod:~$ kubectl get nodes'
          echo 'prod-node-1   Ready'
          echo 'prod-node-2   Ready'
          echo ''
          echo 'pond@prod:~$ kubectl get pods'
          echo 'api        Running'
          echo 'worker     Running'
          echo 'postgres   Running'
          echo ''
          echo 'pond@prod:~$ docker ps'
          echo 'api-service      healthy'
          echo 'frontend         healthy'
          echo ''
          echo 'pond@prod:~$ uptime'
          echo 'production running since 2022 ‚òÅÔ∏è'
          " output/terminal.svg

      # 4Ô∏è‚É£ commit + push
      - name: Commit and push SVG
        uses: EndBug/add-and-commit@v9
        with:
          message: "chore: update devops terminal"
          add: "output/terminal.svg"
