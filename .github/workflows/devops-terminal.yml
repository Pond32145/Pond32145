name: DevOps Terminal

permissions:
  contents: write

on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:

jobs:
  terminal:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y asciinema nodejs npm
          sudo npm install -g svg-term-cli

      - name: Record terminal session
        run: |
          cat << 'EOF' > session.sh
          echo "pond@prod:~$ whoami"
          echo "pond_np31 (DevOps Engineer)"
          echo ""
          echo "pond@prod:~$ kubectl get nodes"
          echo "prod-node-1   Ready"
          echo "prod-node-2   Ready"
          echo ""
          echo "pond@prod:~$ docker ps"
          echo "api-service        running"
          echo "web-frontend       running"
          echo "postgres-db        healthy"
          echo ""
          echo "pond@prod:~$ terraform plan"
          echo "No changes. Infrastructure is up-to-date."
          echo ""
          echo "pond@prod:~$ uptime"
          echo "production running since 2022 ☁️"
          EOF

          asciinema rec session.cast \
            --command "bash session.sh" \
            --cols 80 --rows 24 \
            --quiet

      - name: Render SVG terminal
        run: |
          svg-term \
            --in session.cast \
            --out output/terminal.svg \
            --window \
            --width 80 \
            --height 24

      - name: Commit terminal SVG
        uses: EndBug/add-and-commit@v9
        with:
          message: "chore: update devops terminal"
