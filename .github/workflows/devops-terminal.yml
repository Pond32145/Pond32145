name: DevOps Terminal

permissions:
  contents: write

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */12 * * *"

jobs:
  generate-terminal:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install termtosvg
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip
          pip3 install termtosvg

      - name: Generate static DevOps terminal SVG
        run: |
          rm -rf output
          mkdir -p output

          termtosvg --still -c "
          echo 'pond@prod:~$ whoami'
          echo 'pond_np31 (DevOps Engineer)'
          echo ''
          echo 'pond@prod:~$ kubectl get nodes'
          echo 'prod-node-1   Ready'
          echo 'prod-node-2   Ready'
          echo ''
          echo 'pond@prod:~$ kubectl get pods'
          echo 'api        Running'
          echo 'worker     Running'
          echo 'postgres   Running'
          echo ''
          echo 'pond@prod:~$ uptime'
          echo 'production running since 2022 ☁️'
          " output

          mv output/termtosvg.svg output/terminal.svg

      - name: Commit and push
        uses: EndBug/add-and-commit@v9
        with:
          message: "chore: update devops terminal"
          add: "output/terminal.svg"
